# local.conf for the Demo-System
# Mounted via docker-compose.override.yml as config/local.conf

# Inherits all base settings from evochora.conf
include file("evochora.conf")

logging {
  format = "PLAIN"
}

node {
  processes {
    http {
      options {
        network {
          host = "0.0.0.0"
        }
      }
    }
    h2-console {
      options {
        network {
          host = "0.0.0.0"
        }
        database {
          jdbcUrl = "jdbc:h2:/home/appuser/app/data/database/indexdb;MODE=PostgreSQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;CACHE_SIZE=2097152"
        }
      }
    }
    h2-tcp-server {
      options {
        tcpAllowOthers = true
        database {
          jdbcUrl = "jdbc:h2:/home/appuser/app/data/database/indexdb;MODE=PostgreSQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;CACHE_SIZE=2097152"
        }
      }
    }
  }
}

pipeline {
  autoStart = false
  startupSequence = ["environment-indexer-1", "environment-indexer-2", "organism-indexer-1", "organism-indexer-2", "analytics-indexer-1", "analytics-indexer-2", "metadata-indexer", "metadata-persistence-service", "persistence-service-1", "persistence-service-2", "simulation-engine"]

  database {
    jdbcUrl = "jdbc:h2:/home/appuser/app/data/database/indexdb;MODE=PostgreSQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;CACHE_SIZE=2097152;LOCK_TIMEOUT=10000"
  }

  resources {
    tick-storage {
      options {
        rootDirectory = "/home/appuser/app/data/storage"
      }
    }
  }

  services {
    simulation-engine {
      options {
        pauseTicks = [500000]
        environment {
          shape = [1600, 1200]
        }
      }
    }

    # # Indexers with increased batch size
    # environment-indexer-1 { options { insertBatchSize = 100 } }
    # environment-indexer-2 { options { insertBatchSize = 100 } }
    # organism-indexer-1 { options { insertBatchSize = 100 } }
    # organism-indexer-2 { options { insertBatchSize = 100 } }
    # analytics-indexer-1 { options { insertBatchSize = 100 } }
    # analytics-indexer-2 { options { insertBatchSize = 100 } }

    # # Persistence services with increased batch size
    # persistence-service-1 { options { maxBatchSize = 50 } }
    # persistence-service-2 { options { maxBatchSize = 50 } }
  }
}
